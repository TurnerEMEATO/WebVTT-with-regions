<!-- irony-free zone -->
<!doctype html>
<html>
<head>
  <style>
   body { font:80% Helvetica Neue, sans-serif }
   h1 { font-size:1.2em }
   textarea { width:100%; height:30em }
   .copyright { font-size:.8em; color:gray }
   .video_viewport { width: 360px; height: 240px; background-color: yellow; margin: 5px;}
  </style>
  <script src="helpers.js"></script>
  <script src="parser.js"></script>
  <script src="serialize.js"></script>
  <script src="dom_construction.js"></script>
  <script>
  var test = function() {
    "use strict";

    var video_viewport = [], output = [];
    var parser = [], parsedData = [], dom = [], p;

    // parse textarea
    parser = new WebVTTParser();
    parsedData = parser.parse(document.getElementsByTagName("textarea")[0].value);

    // print errors and WebVTT file as parsed
    printErrors(parsedData.errors, parsedData.time);
    printWebVTTFile(parsedData);

    // assume video dimensions
    var videoWidth = 360;
    var videoHeight = 240;

    // paint every cue into a "screenshot"
    var screenshots = document.getElementById("screenshots");
    // make sure we can still do live painting updates
    // so each call to the test function needs to start without screenshots
    while (screenshots.hasChildNodes()) {
      screenshots.removeChild(screenshots.lastChild);
    }

    // add a video viewport & per cue to the screenshots div
    for (var i = 0; i < parsedData.cues.length; i++) {
      video_viewport[i] = document.createElement("div");
      video_viewport[i].style.position = 'relative';
      video_viewport[i].style.overflow = 'hidden';
      video_viewport[i].setAttribute("class", "video_viewport");
      screenshots.appendChild(video_viewport[i]);
    }

    // calculate the document fragments and their styling for each cue
    // & append into viewports
    dom = new WebVTT2DocumentFragment();
    for (i = 0; i < parsedData.cues.length; i++) {
      output = dom.cue2DOMFragment(parsedData, i, videoWidth, videoHeight, video_viewport[i]);
      p = document.createElement("p");
      p.textContent = "Cue from " + output.startTime + " to " + output.endTime;
      screenshots.insertBefore(p, video_viewport[i]);
      video_viewport[i].appendChild(output.domFragment);
    }
  };
  </script>
</head>
<body onload="test()">
<title>Live WebVTT Validator</title>
<h1>Live <a href="http://dev.w3.org/html5/webvtt/">WebVTT</a> Validator</h1>
<textarea oninput="test()">WEBVTT
Kind: captions
Language: en-US
Region: id=fred width=80% height=3 anchorpoint=0%,100% anchorposition=10%,90% scroll=up
Region: id=bill width=50% height=4 anchorpoint=50%,50% anchorposition=50%,50%

00:00:05.940 --> 00:00:10.610 line:25%
WHEN I GET A SICK BIRD,

00:00:07.040 --> 00:00:11.700 region:fred
THAT JUST <b>STOPS</b> EVERYTHING

1
00:00:09.410 --> 00:00:12.910 region:bill position:20%
FROM MOVING FROM MY PLACE

00:00:10.610 --> 00:00:14.100 region:bill size:50%
TO ANYWHERE 
ELSE OR BEYOND

</textarea>
<p>You need JavaScript for this service.
<ol></ol>
<pre></pre>
<div id="screenshots"></div>
<p class=copyright><a href="https://bitbucket.org/annevk/webvtt">Source code</a> available under CC0.
</body>
</html>