<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
   body { font:80% Helvetica Neue, sans-serif }
   h1 { font-size:1.2em }
   textarea { width:100%; height:30em }
   .copyright { font-size:.8em; color:gray }
   #caption_overlay { position:relative; overflow:hidden; width: 360px; height: 240px; background-color: yellow; margin: 5px;}
   video { width: 360px; height: 240px; }
  </style>
  <script src="helpers.js"></script>
  <script src="parser.js"></script>
  <script src="serialize.js"></script>
  <script src="dom_construction.js"></script>
</head>
<body onload="test()">
<title>Live WebVTT Renderer</title>
<h1>Live <a href="http://dev.w3.org/html5/webvtt/">WebVTT</a> Renderer</h1>
<textarea oninput="test()">WEBVTT
Kind: captions
Language: en-US
Region: id=fred width=80% height=3 viewportanchor=10%,90% regionanchor=0%,100% scroll=up
Region: id=bill width=50% height=4 viewportanchor=50%,50% regionanchor=50%,50%

00:00:05.940 --> 00:00:10.610 line:25%
WHEN I GET A SICK BIRD,

00:00:07.040 --> 00:00:11.700 region:fred
THAT JUST <b>STOPS</b> EVERYTHING

1
00:00:09.410 --> 00:00:12.910 region:bill position:20%
FROM MOVING FROM MY PLACE

00:00:10.610 --> 00:00:14.100 region:bill
TO ANYWHERE 
ELSE OR BEYOND
</textarea>
<p>
  <div id="caption_overlay">
    <video id="video">
      <source src="Big_Buck_Bunny_extract.mp4" type="video/mp4">
      <source src="Big_Buck_Bunny_extract.webm" type="video/webm">
    </video>
  </div>
  <button id="play">Play</button>
  <span id="currentTime"></span>
</p>
<script>
  "use strict";

  var video = document.getElementById("video");
  var captionOverlay = document.getElementById("caption_overlay");
  var parser, parsedData, dom;
  var videoWidth = 360, videoHeight = 240;
  var track, i;

  var test = function() {

    // parse textarea
    parser = new WebVTTParser();
    parsedData = parser.parse(document.getElementsByTagName("textarea")[0].value);

    // calculate the document fragments and their styling for each cue
    dom = new WebVTT2DocumentFragment();
    dom.prepareRegions(parsedData.metadatas, videoWidth, videoHeight);
    dom.appendRegions(captionOverlay);

    // create TextTrack objects for each cue and add them to the video
    track = video.addTextTrack("metadata", "captions", "en-US");
    for (i = 0; i < parsedData.cues.length; i++) {
      var cue;
      cue = new TextTrackCue(parsedData.cues[i].startTime, parsedData.cues[i].endTime, i);
      track.addCue(cue);
      cue.addEventListener("enter", captionShow, false);
      cue.addEventListener("exit", captionRemove, false);
    }
  };

  function captionShow(evt) {
    var cue;
    cue = parsedData.cues[this.text];
    dom.captionShow(cue, this.text, videoWidth, videoHeight, captionOverlay);
  }

  function captionRemove(evt) {
    var cue;
    cue = parsedData.cues[this.text];
    dom.captionRemove(cue, this.text);
  }

  var play  = document.getElementById("play");
  play.addEventListener("click", togglePlay, false);
  function togglePlay(evt) {
    if (video.paused == false) {
      video.pause();
      play.innerHTML = "play";
    } else {
      video.play();
      play.innerHTML = "pause";
    }
  }

  var currentTime = document.getElementById("currentTime");
  video.addEventListener("timeupdate", updateCurrentTime, false);
  function updateCurrentTime(evt) {
    currentTime.innerHTML = video.currentTime.toFixed(2);
  }
</script>
<p>You need JavaScript for this service.</p>
<p class=copyright><a href="https://github.com/silviapfeiffer/WebVTT-with-regions">Source code</a> available under CC0.
</p>
</body>
</html>